{% load jinja_filters %}

{% for balance in balance_lists %}
    <div class="card selectable"
         {% if balance.transaction_type == 'debt' %}
             style="background-color: #ffe5e5;"
         {% else %}
             style="background-color: #e5fbe5;"
         {% endif %}
         onclick="toggleHighlight(this)">
         
        <div class="card-header">
            <div class="row align-items-center">
                <div class="col d-flex justify-content-end">
                    <a class="edit-balance" href="{% url 'UpdateBalanceView' balance.document.id %}">
                        <div class="flex-shrink-0">
                            <h5><i class="fas fa-user-circle"></i>{{ balance.account }}</h5>
                        </div>
                    </a>
                </div>
                <div class="col d-flex justify-content-start">
                    {% if balance.image %}
                    <div class="grid g-3">
                        <a class="card-gallery" data-fslightbox="gallery" href="{{ balance.image.url }}">
                            <img class="img-fluid" src="{{ balance.image.url }}" alt="Card image" style="width:50%">
                            <div class="gallery-hover-data card-body justify-content-end"></div>
                        </a>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <table class="table">
            <thead>
            <tr>
                <th scope="col">سند</th>
                <th scope="col">تاریخ</th>
                <th scope="col">مبلغ</th>
                <th scope="col">چک</th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <th scope="row">{{ balance.document.id }}</th>
                <td>{{ balance.document.date_created }}</td>
                <td>{{ balance.amount|toman }}</td>
                <td>{% if not balance.cheque %}ندارد{% else %}{{ balance.cheque.cheque_status }}{% endif %}</td>
            </tr>
            </tbody>
        </table>

        <div class="row">
            <p>توضیحات: {{ balance.description }}</p>
        </div>
    </div>
{% endfor %}

<style>
/* استایل هایلایت کارت */
.card.highlight {
  outline: 2px solid blue;
  box-shadow: 0 0 8px rgba(0, 0, 255, 0.5);
}
</style>

<script>
function toggleHighlight(element) {
    // فقط تغییر وضعیت هایلایت (چند کارت می‌تونه انتخاب بشه)
    element.classList.toggle('highlight');
}
</script>


<script>
    $('.edit-balance').each(function () {
        const currentUrl = window.location.href;
        const href = $(this).attr('href');
        const separator = href.includes('?') ? '&' : '?';
        $(this).attr('href', href + separator + 'next=' + encodeURIComponent(currentUrl));
    });

    function selectCard(element) {
        // اگر فقط یکی باید فعال باشه:
        document.querySelectorAll('.card').forEach(c => c.classList.remove('highlight'));
        element.classList.add('highlight');
    }
</script>